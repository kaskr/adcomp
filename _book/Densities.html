<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Multivariate distributions | The comprehensive TMB documentation</title>
  <meta name="description" content="Comprehensive documentation of TMB - theory and examples." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Multivariate distributions | The comprehensive TMB documentation" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://kaskr.github.io/adcomp/" />
  <meta property="og:image" content="https://kaskr.github.io/adcomp//images/cover.png" />
  <meta property="og:description" content="Comprehensive documentation of TMB - theory and examples." />
  <meta name="github-repo" content="kaskr/adcomp" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Multivariate distributions | The comprehensive TMB documentation" />
  
  <meta name="twitter:description" content="Comprehensive documentation of TMB - theory and examples." />
  <meta name="twitter:image" content="https://kaskr.github.io/adcomp//images/cover.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="R_style_distribution.html"/>
<link rel="next" href="Examples.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="Introduction.html"><a href="Introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="Tutorial.html"><a href="Tutorial.html"><i class="fa fa-check"></i><b>2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Tutorial.html"><a href="Tutorial.html#obtaining-data-and-parameter-values-from-r"><i class="fa fa-check"></i><b>2.1</b> Obtaining data and parameter values from R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="Tutorial.html"><a href="Tutorial.html#list-of-data-macros"><i class="fa fa-check"></i><b>2.1.1</b> List of data macros</a></li>
<li class="chapter" data-level="2.1.2" data-path="Tutorial.html"><a href="Tutorial.html#list-of-parameter-macros"><i class="fa fa-check"></i><b>2.1.2</b> List of parameter macros</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="Tutorial.html"><a href="Tutorial.html#an-extended-c-language"><i class="fa fa-check"></i><b>2.2</b> An extended C++ language</a></li>
<li class="chapter" data-level="2.3" data-path="Tutorial.html"><a href="Tutorial.html#statistical-modelling"><i class="fa fa-check"></i><b>2.3</b> Statistical modelling</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Structure_TMB.html"><a href="Structure_TMB.html"><i class="fa fa-check"></i><b>3</b> The structure of TMB</a></li>
<li class="chapter" data-level="4" data-path="matrix_arrays.html"><a href="matrix_arrays.html"><i class="fa fa-check"></i><b>4</b> Matrices and arrays</a>
<ul>
<li class="chapter" data-level="4.1" data-path="matrix_arrays.html"><a href="matrix_arrays.html#relationship-to-r"><i class="fa fa-check"></i><b>4.1</b> Relationship to R</a></li>
<li class="chapter" data-level="4.2" data-path="matrix_arrays.html"><a href="matrix_arrays.html#relationship-to-eigen"><i class="fa fa-check"></i><b>4.2</b> Relationship to Eigen</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="R_style_distribution.html"><a href="R_style_distribution.html"><i class="fa fa-check"></i><b>5</b> R style probability distributions</a></li>
<li class="chapter" data-level="6" data-path="Densities.html"><a href="Densities.html"><i class="fa fa-check"></i><b>6</b> Multivariate distributions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Densities.html"><a href="Densities.html#multivariate-normal-distributions"><i class="fa fa-check"></i><b>6.1</b> Multivariate normal distributions</a></li>
<li class="chapter" data-level="6.2" data-path="Densities.html"><a href="Densities.html#autoregressive-processes"><i class="fa fa-check"></i><b>6.2</b> Autoregressive processes</a></li>
<li class="chapter" data-level="6.3" data-path="Densities.html"><a href="Densities.html#gaussian-markov-random-fields-gmrf"><i class="fa fa-check"></i><b>6.3</b> Gaussian Markov random fields (GMRF)</a></li>
<li class="chapter" data-level="6.4" data-path="Densities.html"><a href="Densities.html#separable-construction-of-covariance-precision-matrices"><i class="fa fa-check"></i><b>6.4</b> Separable construction of covariance (precision) matrices</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Examples.html"><a href="Examples.html"><i class="fa fa-check"></i><b>7</b> Example collection</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Examples.html"><a href="Examples.html#example-overview"><i class="fa fa-check"></i><b>7.1</b> Example overview</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Errors.html"><a href="Errors.html"><i class="fa fa-check"></i><b>8</b> Compilation and run time errors</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Errors.html"><a href="Errors.html#compilation-errors"><i class="fa fa-check"></i><b>8.1</b> Compilation errors</a></li>
<li class="chapter" data-level="8.2" data-path="Errors.html"><a href="Errors.html#run-time-errors"><i class="fa fa-check"></i><b>8.2</b> Run time errors</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="Errors.html"><a href="Errors.html#out-of-bounds-error"><i class="fa fa-check"></i><b>8.2.1</b> Out-of-bounds error</a></li>
<li class="chapter" data-level="8.2.2" data-path="Errors.html"><a href="Errors.html#floating-point-exception"><i class="fa fa-check"></i><b>8.2.2</b> Floating point exception</a></li>
<li class="chapter" data-level="8.2.3" data-path="Errors.html"><a href="Errors.html#missing-casts-for-vectorized-functions"><i class="fa fa-check"></i><b>8.2.3</b> Missing casts for vectorized functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Toolbox.html"><a href="Toolbox.html"><i class="fa fa-check"></i><b>9</b> Toolbox</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="Toolbox.html"><a href="Toolbox.html#non-normal-latent-variables-random-effects"><i class="fa fa-check"></i><b>9.0.1</b> Non-normal latent variables (random effects)</a></li>
<li class="chapter" data-level="9.0.2" data-path="Toolbox.html"><a href="Toolbox.html#discrete-latent-variables"><i class="fa fa-check"></i><b>9.0.2</b> Discrete latent variables</a></li>
<li class="chapter" data-level="9.0.3" data-path="Toolbox.html"><a href="Toolbox.html#mixture-models"><i class="fa fa-check"></i><b>9.0.3</b> Mixture models</a></li>
<li class="chapter" data-level="9.0.4" data-path="Toolbox.html"><a href="Toolbox.html#time-series"><i class="fa fa-check"></i><b>9.0.4</b> Time series</a></li>
<li class="chapter" data-level="9.0.5" data-path="Toolbox.html"><a href="Toolbox.html#spatial-models"><i class="fa fa-check"></i><b>9.0.5</b> Spatial models</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="CppTutorial.html"><a href="CppTutorial.html"><i class="fa fa-check"></i><b>10</b> C++ tutorial</a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="CppTutorial.html"><a href="CppTutorial.html#i-know-r-but-not-c"><i class="fa fa-check"></i><b>10.0.1</b> I know R but not C++</a></li>
<li class="chapter" data-level="10.0.2" data-path="CppTutorial.html"><a href="CppTutorial.html#i-know-c"><i class="fa fa-check"></i><b>10.0.2</b> I know C++</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ModelObject.html"><a href="ModelObject.html"><i class="fa fa-check"></i><b>11</b> Model object</a></li>
<li class="chapter" data-level="12" data-path="Sparsity.html"><a href="Sparsity.html"><i class="fa fa-check"></i><b>12</b> Sparsity</a>
<ul>
<li class="chapter" data-level="12.1" data-path="Sparsity.html"><a href="Sparsity.html#conditional-independence-graphs-and-dags"><i class="fa fa-check"></i><b>12.1</b> Conditional independence graphs and DAGs</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="Sparsity.html"><a href="Sparsity.html#conditional-independence"><i class="fa fa-check"></i><b>12.1.1</b> Conditional independence</a></li>
<li class="chapter" data-level="12.1.2" data-path="Sparsity.html"><a href="Sparsity.html#node-removal-properties"><i class="fa fa-check"></i><b>12.1.2</b> Node removal properties</a></li>
<li class="chapter" data-level="12.1.3" data-path="Sparsity.html"><a href="Sparsity.html#directed-acyclic-graph"><i class="fa fa-check"></i><b>12.1.3</b> Directed acyclic graph</a></li>
<li class="chapter" data-level="12.1.4" data-path="Sparsity.html"><a href="Sparsity.html#the-effect-of-adding-data"><i class="fa fa-check"></i><b>12.1.4</b> The effect of adding data</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="Sparsity.html"><a href="Sparsity.html#the-theta-logistic-example"><i class="fa fa-check"></i><b>12.2</b> The theta logistic example</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Simulation.html"><a href="Simulation.html"><i class="fa fa-check"></i><b>13</b> Simulation</a>
<ul>
<li class="chapter" data-level="13.1" data-path="Simulation.html"><a href="Simulation.html#overview-of-simulation-methods-in-tmb"><i class="fa fa-check"></i><b>13.1</b> Overview of simulation methods in TMB</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="Simulation.html"><a href="Simulation.html#standard-generators"><i class="fa fa-check"></i><b>13.1.1</b> Standard generators</a></li>
<li class="chapter" data-level="13.1.2" data-path="Simulation.html"><a href="Simulation.html#generators-for-density-objects"><i class="fa fa-check"></i><b>13.1.2</b> Generators for density objects</a></li>
<li class="chapter" data-level="13.1.3" data-path="Simulation.html"><a href="Simulation.html#controlling-the-random-seed"><i class="fa fa-check"></i><b>13.1.3</b> Controlling the random seed</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="Simulation.html"><a href="Simulation.html#simulation-blocks"><i class="fa fa-check"></i><b>13.2</b> Simulation blocks</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="Simulation.html"><a href="Simulation.html#a-linear-regression-example"><i class="fa fa-check"></i><b>13.2.1</b> A linear regression example</a></li>
<li class="chapter" data-level="13.2.2" data-path="Simulation.html"><a href="Simulation.html#a-simulation-study"><i class="fa fa-check"></i><b>13.2.2</b> A simulation study</a></li>
<li class="chapter" data-level="13.2.3" data-path="Simulation.html"><a href="Simulation.html#advanced-examples"><i class="fa fa-check"></i><b>13.2.3</b> Advanced examples</a></li>
<li class="chapter" data-level="13.2.4" data-path="Simulation.html"><a href="Simulation.html#further-notes"><i class="fa fa-check"></i><b>13.2.4</b> Further notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>14</b> Validation</a>
<ul>
<li class="chapter" data-level="14.1" data-path="Validation.html"><a href="Validation.html#residuals"><i class="fa fa-check"></i><b>14.1</b> Residuals</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="Validation.html"><a href="Validation.html#models-without-random-effects"><i class="fa fa-check"></i><b>14.1.1</b> Models without random effects</a></li>
<li class="chapter" data-level="14.1.2" data-path="Validation.html"><a href="Validation.html#models-with-random-effects"><i class="fa fa-check"></i><b>14.1.2</b> Models with random effects</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="Validation.html"><a href="Validation.html#checking-the-laplace-approximation"><i class="fa fa-check"></i><b>14.2</b> Checking the Laplace approximation</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html"><i class="fa fa-check"></i><b>15</b> Atomic functions</a>
<ul>
<li class="chapter" data-level="15.1" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#reverse-mode-differentiation"><i class="fa fa-check"></i><b>15.1</b> Reverse mode differentiation</a></li>
<li class="chapter" data-level="15.2" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#example-adding-new-primitive-function-with-known-derivatives"><i class="fa fa-check"></i><b>15.2</b> Example: Adding new primitive function with known derivatives</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#testing-the-primitive-function"><i class="fa fa-check"></i><b>15.2.1</b> Testing the primitive function</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#other-approaches"><i class="fa fa-check"></i><b>15.3</b> Other approaches</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="Appendix.html"><a href="Appendix.html"><i class="fa fa-check"></i><b>16</b> Appendix</a>
<ul>
<li class="chapter" data-level="16.1" data-path="Appendix.html"><a href="Appendix.html#notation"><i class="fa fa-check"></i><b>16.1</b> Notation</a></li>
<li class="chapter" data-level="16.2" data-path="Appendix.html"><a href="Appendix.html#profiling-the-inner-problem"><i class="fa fa-check"></i><b>16.2</b> Profiling the inner problem</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="Appendix.html"><a href="Appendix.html#example"><i class="fa fa-check"></i><b>16.2.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="Appendix.html"><a href="Appendix.html#theory-underlying-sdreport"><i class="fa fa-check"></i><b>16.3</b> Theory underlying sdreport</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The comprehensive TMB documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Densities" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Multivariate distributions</h1>
<p>The namespace</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="Densities.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> <a class="code" href="../namespacedensity.html">density</a>;</span></code></pre></div>
<p>gives access to a variety of multivariate normal distributions:</p>
<ul>
<li>Multivariate normal distributions specified via a covariance matrix
(structured or unstructured).</li>
<li>Autoregressive (AR) processes.</li>
<li>Gaussian Markov random fields (GMRF) defined on regular grids or
defined via a (sparse) precision matrix.</li>
<li>Separable covariance functions, i.e. time-space separability.</li>
</ul>
<p>These seemingly unrelated concepts are all implemented via the notion
of a <code>distribution</code>, which explains why they are placed in the same
namespace. You can combine two <code>distributions</code>, and this lets you
build up complex multivariate distributions using extremely compact
notation. Due to the flexibility of the approach it is more abstract
than other parts of TMB, but here it will be explained from
scratch. Before looking at the different categories of multivariate
distributions we note the following which is of practical importance:</p>
<ul>
<li>All members in the <code>density</code> namespace return the <strong>negative</strong> log
density, opposed to the univariate densities in <a href="R_style_distribution.html#R_style_distribution">R style distributions</a>.</li>
</ul>
<div id="multivariate-normal-distributions" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Multivariate normal distributions</h2>
<p>Consider a zero-mean multivariate normal distribution
with covariance matrix <em>Sigma</em> (symmetric positive definite),
that we want to evaluate at <em>x</em>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="Densities.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n = <span class="dv">10</span>;</span>
<span id="cb8-2"><a href="Densities.html#cb8-2" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structvector.html">vector</a>&lt;Type&gt; <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>(n);           <span class="co">// Evaluation point           </span></span>
<span id="cb8-3"><a href="Densities.html#cb8-3" aria-hidden="true" tabindex="-1"></a>x.<a class="code" href="../structdata__indicator.html#a58dba081c3cf4870fa92cfde3a373357">fill</a>(<span class="fl">0.0</span>);                 <span class="co">// Point of evaluation: <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a> = (0,0,...,0)</span></span></code></pre></div>
<p>The negative log-normal density is evaluated as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="Densities.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> <a class="code" href="../namespacedensity.html">density</a>;</span>
<span id="cb9-2"><a href="Densities.html#cb9-2" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structarray.html#accfc8dbb05153041d1d72dbbec388130">matrix</a>&lt;Type&gt; Sigma(n,n);     <span class="co">// Covariance matrix</span></span>
<span id="cb9-3"><a href="Densities.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ..... User must assign <a class="code" href="../namespaceTMBad.html#ae0f11020200051df812c0540a9cf7d02">value</a> to Sigma here</span></span>
<span id="cb9-4"><a href="Densities.html#cb9-4" aria-hidden="true" tabindex="-1"></a>res = <a class="code" href="../density_8hpp.html#a0ab00cdcb2757d23910a6d54523eec07">MVNORM</a>(Sigma)(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>);      <span class="co">// Evaluate negative log likelihod</span></span></code></pre></div>
<p>In the last line <code><a class="code" href="../density_8hpp.html#a0ab00cdcb2757d23910a6d54523eec07">MVNORM</a>(Sigma)</code> should be interpreted as a
multivariate density, which via the last parenthesis <code>(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>)</code> is
evaluated at <code>x</code>. A less compact way of expressing this is</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="Densities.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">MVNORM_t</span>&lt;Type&gt; your_dmnorm(Sigma);</span>
<span id="cb10-2"><a href="Densities.html#cb10-2" aria-hidden="true" tabindex="-1"></a>res = your_dmnorm(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>);</span></code></pre></div>
<p>in which <code>your_dmnorm</code> is a variable that holds the “density.”</p>
<p>Note, that the latter way (using the <code>MVNORM_t</code>) is <em>more efficient</em>
when you need to evaluate the density more than once, i.e. for different values of <code>x</code>.</p>
<p><em>Sigma</em> can be parameterized in different ways. Due to the symmetry of
<em>Sigma</em> there are at most <em>n(n+1)/2</em> free parameters (<em>n</em> variances
and <em>n(n-1)/2</em> correlation parameters). If you want to estimate all of
these freely (modulo the positive definite constraint) you can use
<code><a class="code" href="../density_8hpp.html#ac4f63b9a5cd5b2eff0871db3fd889fd5">UNSTRUCTURED_CORR</a>()</code> to specify the correlation matrix, and
<code><a class="code" href="../density_8hpp.html#aae30a0275dafde20092e4c12c6bda61e">VECSCALE</a>()</code> to specify variances. <code><a class="code" href="../density_8hpp.html#ac4f63b9a5cd5b2eff0871db3fd889fd5">UNSTRUCTURED_CORR</a>()</code> takes as
input a vector a dummy parameters that internally is used to build the
correlation matrix via its cholesky factor.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="Densities.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> <a class="code" href="../namespacedensity.html">density</a>;</span>
<span id="cb11-2"><a href="Densities.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n = <span class="dv">10</span>;</span>
<span id="cb11-3"><a href="Densities.html#cb11-3" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structvector.html">vector</a>&lt;Type&gt; unconstrained_params(n*(n-<span class="dv">1</span>)/<span class="dv">2</span>);  <span class="co">// Dummy parameterization of correlation matrix</span></span>
<span id="cb11-4"><a href="Densities.html#cb11-4" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structvector.html">vector</a>&lt;Type&gt; sds(n);                           <span class="co">// Standard deviations</span></span>
<span id="cb11-5"><a href="Densities.html#cb11-5" aria-hidden="true" tabindex="-1"></a>res = <a class="code" href="../density_8hpp.html#aae30a0275dafde20092e4c12c6bda61e">VECSCALE</a>(<a class="code" href="../density_8hpp.html#ac4f63b9a5cd5b2eff0871db3fd889fd5">UNSTRUCTURED_CORR</a>(unconstrained_params),sds)(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>);</span></code></pre></div>
<p>If all elements of <code>dummy_params</code> are estimated we are in effect
estimating a full correlation matrix without any constraints on its
elements (except for the mandatory positive definiteness). The actual
value of the correlation matrix, but not the full covariance matrix,
can easily be assessed using the <code>.<a class="code" href="../classMVNORM__t.html#a7bd0bc2ecad6f323974b247b81220acc">cov</a>()</code> operator</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="Densities.html#cb12-1" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structarray.html#accfc8dbb05153041d1d72dbbec388130">matrix</a>&lt;Type&gt; Sigma(n,n);</span>
<span id="cb12-2"><a href="Densities.html#cb12-2" aria-hidden="true" tabindex="-1"></a>Sigma = <a class="code" href="../density_8hpp.html#ac4f63b9a5cd5b2eff0871db3fd889fd5">UNSTRUCTURED_CORR</a>(unconstrained_params).<a class="code" href="../classMVNORM__t.html#a7bd0bc2ecad6f323974b247b81220acc">cov</a>();</span>
<span id="cb12-3"><a href="Densities.html#cb12-3" aria-hidden="true" tabindex="-1"></a><a class="code" href="../group__macros.html#gac2d7888f4e0385930448f992de53079b">REPORT</a>(Sigma);                                         <span class="co">// Report back to <a class="code" href="../structinterpol2D__config.html#a8e8fccc28eb97428896340a222d199d5">R</a> session</span></span></code></pre></div>
</div>
<div id="autoregressive-processes" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Autoregressive processes</h2>
<p>Consider a stationary univariate Gaussian AR1 process
<em>x(t),t=0,…,n-1</em>. The stationary distribution is choosen so that:</p>
<ul>
<li><em>x(t)</em> has mean 0 and variance 1 (for all <em>t</em>).</li>
</ul>
<p>The multivariate density of the vector <em>x</em> can be evaluated as follows</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="Densities.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n = <span class="dv">10</span>;</span>
<span id="cb13-2"><a href="Densities.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> <a class="code" href="../namespacedensity.html">density</a>;</span>
<span id="cb13-3"><a href="Densities.html#cb13-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-4"><a href="Densities.html#cb13-4" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structvector.html">vector</a>&lt;Type&gt; <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>(n);           <span class="co">// Evaluation point</span></span>
<span id="cb13-5"><a href="Densities.html#cb13-5" aria-hidden="true" tabindex="-1"></a>x.<a class="code" href="../structdata__indicator.html#a58dba081c3cf4870fa92cfde3a373357">fill</a>(<span class="fl">0.0</span>);                 <span class="co">// Point of evaluation: <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a> = (0,0,...,0)</span></span>
<span id="cb13-6"><a href="Densities.html#cb13-6" aria-hidden="true" tabindex="-1"></a>Type rho = <span class="fl">0.2</span>;              <span class="co">// Correlation parameter</span></span>
<span id="cb13-7"><a href="Densities.html#cb13-7" aria-hidden="true" tabindex="-1"></a>res = AR1(rho)(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>);           <span class="co">// Evaluate negative log-<a class="code" href="../namespacedensity.html">density</a> of AR1 process at point <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a> </span></span></code></pre></div>
<p>Due to the assumed stationarity the correlation parameter must
satisfy:</p>
<ul>
<li><strong>Stationarity</strong> constraint: -1 &lt; <em>rho</em> &lt; 1</li>
</ul>
<p>Note that <em>cor[x(t),x(t-1)] = rho</em>.</p>
<p>The <code>SCALE()</code> function can be used to set the standard deviation.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="Densities.html#cb14-1" aria-hidden="true" tabindex="-1"></a>Type sigma = <span class="fl">2.1</span>;            <span class="co">// standard deviation of x</span></span>
<span id="cb14-2"><a href="Densities.html#cb14-2" aria-hidden="true" tabindex="-1"></a>res = SCALE(AR1(rho),sigma)(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>);</span></code></pre></div>
<p>Now, <em>var[x(t)] = sigma^2</em>. Because all elements of <code>x</code> are scaled by
the same constant we use SCALE rather than VECSCALE.</p>
<div id="multivariate-ar1-processes" class="section level4" number="6.2.0.1">
<h4><span class="header-section-number">6.2.0.1</span> Multivariate AR1 processes</h4>
<p>This is the first real illustration of how distributions can be used
as building blocks to obtain more complex distributions. Consider the
<em>p</em> dimensional AR1 process</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="Densities.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n = <span class="dv">10</span>;                   <span class="co">// Number of time steps</span></span>
<span id="cb15-2"><a href="Densities.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> p=<span class="dv">3</span>;                      <span class="co">// <a class="code" href="../structTMBad_1_1clique.html#aa20a8e53a8dfbc21d44eb1539f622f55">dim</a>(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>)</span></span>
<span id="cb15-3"><a href="Densities.html#cb15-3" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structarray.html">array</a>&lt;Type&gt; <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>(p,n);           <span class="co">// Evaluation point</span></span></code></pre></div>
<p>The columns in <code>x</code> refer to the different time points. We then
evaluate the (negative log) joint density of the time series.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="Densities.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">MVNORM_t</span>&lt;Type&gt; your_dmnorm(Sigma);  <span class="co">// Density of <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>(t) </span></span>
<span id="cb16-2"><a href="Densities.html#cb16-2" aria-hidden="true" tabindex="-1"></a>Type phi;                           <span class="co">// Correlation parameter</span></span>
<span id="cb16-3"><a href="Densities.html#cb16-3" aria-hidden="true" tabindex="-1"></a>res = AR1(phi,your_dmnorm)(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>);</span></code></pre></div>
<p>Note the following:</p>
<ul>
<li>We have introduced an intermediate variable <code>your_dmnorm</code>, which
holds the p-dim density marginal density of <em>x(t)</em>. This is a
zero-mean normal density with covariance matrix <code>Sigma</code>.</li>
<li>All <em>p</em> univarite time series have the same serial correlation <em>phi</em>.</li>
<li>The multivariate process <em>x(t)</em> is stationary in the same sense as
the univariate AR1 process described above.</li>
</ul>
</div>
<div id="higher-order-ar-processes" class="section level4" number="6.2.0.2">
<h4><span class="header-section-number">6.2.0.2</span> Higher order AR processes</h4>
<p>There also exists <code>ARk_t</code> of arbitrary autoregressive order.</p>
</div>
</div>
<div id="gaussian-markov-random-fields-gmrf" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Gaussian Markov random fields (GMRF)</h2>
<p>GMRF may be defined in two ways:</p>
<ol style="list-style-type: decimal">
<li>Via a (sparse) precision matrix Q.</li>
<li>Via a d-dimensional lattice.</li>
</ol>
<p>For further details please see <code>GMRF_t</code>. Under 1) a sparse Q
corresponding to a Matern covariance function can be obtained via the
<code>R_inla</code> namespace.</p>
</div>
<div id="separable-construction-of-covariance-precision-matrices" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Separable construction of covariance (precision) matrices</h2>
<p>A typical use of separability is to create space-time models with a
sparse precision matrix. Details are given in <code>SEPARABLE_t</code>. Here
we give a simple example.</p>
<p>Assume that we study a quantity <code>x</code> that changes both in space and
time. For simplicity we consider only a one-dimensional space. We
discretize space and time using equidistant grids, and assume that the
distance between grid points is 1 in both dimensions. We then define
an <code>AR1(rho_s)</code> process in space and one in time <code>AR1(rho_t)</code>. The
separable assumption is that two points <code>x1</code> and <code>x2</code>, separated in
space by a distance <code>ds</code> and in time by a distance <code>dt</code>, have
correlation given by</p>
<p><code>rho_s^ds*rho_t^dt</code></p>
<p>This is implemented as</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb17-1"><a href="Densities.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> <a class="code" href="../namespacedensity.html">density</a>;</span>
<span id="cb17-2"><a href="Densities.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n_s = <span class="dv">10</span>;                   <span class="co">// Number of grid points in space</span></span>
<span id="cb17-3"><a href="Densities.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="dt">n_t</span> = <span class="dv">10</span>;                   <span class="co">// Number of grid points in time</span></span>
<span id="cb17-4"><a href="Densities.html#cb17-4" aria-hidden="true" tabindex="-1"></a>Type rho_s = <span class="fl">0.2</span>;               <span class="co">// Correlation in space</span></span>
<span id="cb17-5"><a href="Densities.html#cb17-5" aria-hidden="true" tabindex="-1"></a>Type <span class="dt">rho_t</span> = <span class="fl">0.4</span>;               <span class="co">// Correlation in time</span></span>
<span id="cb17-6"><a href="Densities.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="Densities.html#cb17-7" aria-hidden="true" tabindex="-1"></a><a class="code" href="../structarray.html">array</a>&lt;Type&gt; <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>(n_s,<span class="dt">n_t</span>);</span>
<span id="cb17-8"><a href="Densities.html#cb17-8" aria-hidden="true" tabindex="-1"></a>x.setZero();                    <span class="co">// <a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a> = 0</span></span>
<span id="cb17-9"><a href="Densities.html#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="Densities.html#cb17-10" aria-hidden="true" tabindex="-1"></a>res = <a class="code" href="../density_8hpp.html#afd76474bb73fa9af11b9dfb6c11f0c57">SEPARABLE</a>(AR1(<span class="dt">rho_t</span>),AR1(rho_s))(<a class="code" href="../structTMBad_1_1ForwardArgs.html#acd57f895cadf784409ff7843d369ed2d">x</a>);</span></code></pre></div>
<p>Note that the arguments to <code><a class="code" href="../density_8hpp.html#afd76474bb73fa9af11b9dfb6c11f0c57">SEPARABLE</a>()</code> are given in the opposite order
to the dimensions of <code>x</code>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="R_style_distribution.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Examples.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
