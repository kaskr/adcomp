<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Tutorial | The comprehensive TMB documentation</title>
  <meta name="description" content="Comprehensive documentation of TMB - theory and examples." />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Tutorial | The comprehensive TMB documentation" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://kaskr.github.io/adcomp//images/cover.png" />
  <meta property="og:description" content="Comprehensive documentation of TMB - theory and examples." />
  <meta name="github-repo" content="kaskr/adcomp" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Tutorial | The comprehensive TMB documentation" />
  
  <meta name="twitter:description" content="Comprehensive documentation of TMB - theory and examples." />
  <meta name="twitter:image" content="https://kaskr.github.io/adcomp//images/cover.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Introduction.html"/>
<link rel="next" href="Structure_TMB.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="Introduction.html"><a href="Introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="Tutorial.html"><a href="Tutorial.html"><i class="fa fa-check"></i><b>2</b> Tutorial</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Tutorial.html"><a href="Tutorial.html#obtaining-data-and-parameter-values-from-r"><i class="fa fa-check"></i><b>2.1</b> Obtaining data and parameter values from R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="Tutorial.html"><a href="Tutorial.html#list-of-data-macros"><i class="fa fa-check"></i><b>2.1.1</b> List of data macros</a></li>
<li class="chapter" data-level="2.1.2" data-path="Tutorial.html"><a href="Tutorial.html#list-of-parameter-macros"><i class="fa fa-check"></i><b>2.1.2</b> List of parameter macros</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="Tutorial.html"><a href="Tutorial.html#an-extended-c-language"><i class="fa fa-check"></i><b>2.2</b> An extended C++ language</a></li>
<li class="chapter" data-level="2.3" data-path="Tutorial.html"><a href="Tutorial.html#statistical-modelling"><i class="fa fa-check"></i><b>2.3</b> Statistical modelling</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Structure_TMB.html"><a href="Structure_TMB.html"><i class="fa fa-check"></i><b>3</b> The structure of TMB</a></li>
<li class="chapter" data-level="4" data-path="matrix_arrays.html"><a href="matrix_arrays.html"><i class="fa fa-check"></i><b>4</b> Matrices and arrays</a>
<ul>
<li class="chapter" data-level="4.1" data-path="matrix_arrays.html"><a href="matrix_arrays.html#relationship-to-r"><i class="fa fa-check"></i><b>4.1</b> Relationship to R</a></li>
<li class="chapter" data-level="4.2" data-path="matrix_arrays.html"><a href="matrix_arrays.html#relationship-to-eigen"><i class="fa fa-check"></i><b>4.2</b> Relationship to Eigen</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="R_style_distribution.html"><a href="R_style_distribution.html"><i class="fa fa-check"></i><b>5</b> R style probability distributions</a></li>
<li class="chapter" data-level="6" data-path="Densities.html"><a href="Densities.html"><i class="fa fa-check"></i><b>6</b> Multivariate distributions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="Densities.html"><a href="Densities.html#multivariate-normal-distributions"><i class="fa fa-check"></i><b>6.1</b> Multivariate normal distributions</a></li>
<li class="chapter" data-level="6.2" data-path="Densities.html"><a href="Densities.html#autoregressive-processes"><i class="fa fa-check"></i><b>6.2</b> Autoregressive processes</a></li>
<li class="chapter" data-level="6.3" data-path="Densities.html"><a href="Densities.html#gaussian-markov-random-fields-gmrf"><i class="fa fa-check"></i><b>6.3</b> Gaussian Markov random fields (GMRF)</a></li>
<li class="chapter" data-level="6.4" data-path="Densities.html"><a href="Densities.html#separable-construction-of-covariance-precision-matrices"><i class="fa fa-check"></i><b>6.4</b> Separable construction of covariance (precision) matrices</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="Examples.html"><a href="Examples.html"><i class="fa fa-check"></i><b>7</b> Example collection</a>
<ul>
<li class="chapter" data-level="7.1" data-path="Examples.html"><a href="Examples.html#example-overview"><i class="fa fa-check"></i><b>7.1</b> Example overview</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Errors.html"><a href="Errors.html"><i class="fa fa-check"></i><b>8</b> Compilation and run time errors</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Errors.html"><a href="Errors.html#compilation-errors"><i class="fa fa-check"></i><b>8.1</b> Compilation errors</a></li>
<li class="chapter" data-level="8.2" data-path="Errors.html"><a href="Errors.html#run-time-errors"><i class="fa fa-check"></i><b>8.2</b> Run time errors</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="Errors.html"><a href="Errors.html#out-of-bounds-error"><i class="fa fa-check"></i><b>8.2.1</b> Out-of-bounds error</a></li>
<li class="chapter" data-level="8.2.2" data-path="Errors.html"><a href="Errors.html#floating-point-exception"><i class="fa fa-check"></i><b>8.2.2</b> Floating point exception</a></li>
<li class="chapter" data-level="8.2.3" data-path="Errors.html"><a href="Errors.html#missing-casts-for-vectorized-functions"><i class="fa fa-check"></i><b>8.2.3</b> Missing casts for vectorized functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Toolbox.html"><a href="Toolbox.html"><i class="fa fa-check"></i><b>9</b> Toolbox</a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="Toolbox.html"><a href="Toolbox.html#non-normal-latent-variables-random-effects"><i class="fa fa-check"></i><b>9.0.1</b> Non-normal latent variables (random effects)</a></li>
<li class="chapter" data-level="9.0.2" data-path="Toolbox.html"><a href="Toolbox.html#discrete-latent-variables"><i class="fa fa-check"></i><b>9.0.2</b> Discrete latent variables</a></li>
<li class="chapter" data-level="9.0.3" data-path="Toolbox.html"><a href="Toolbox.html#mixture-models"><i class="fa fa-check"></i><b>9.0.3</b> Mixture models</a></li>
<li class="chapter" data-level="9.0.4" data-path="Toolbox.html"><a href="Toolbox.html#time-series"><i class="fa fa-check"></i><b>9.0.4</b> Time series</a></li>
<li class="chapter" data-level="9.0.5" data-path="Toolbox.html"><a href="Toolbox.html#spatial-models"><i class="fa fa-check"></i><b>9.0.5</b> Spatial models</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="CppTutorial.html"><a href="CppTutorial.html"><i class="fa fa-check"></i><b>10</b> C++ tutorial</a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="CppTutorial.html"><a href="CppTutorial.html#i-know-r-but-not-c"><i class="fa fa-check"></i><b>10.0.1</b> I know R but not C++</a></li>
<li class="chapter" data-level="10.0.2" data-path="CppTutorial.html"><a href="CppTutorial.html#i-know-c"><i class="fa fa-check"></i><b>10.0.2</b> I know C++</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ModelObject.html"><a href="ModelObject.html"><i class="fa fa-check"></i><b>11</b> Model object</a></li>
<li class="chapter" data-level="12" data-path="Sparsity.html"><a href="Sparsity.html"><i class="fa fa-check"></i><b>12</b> Sparsity</a>
<ul>
<li class="chapter" data-level="12.1" data-path="Sparsity.html"><a href="Sparsity.html#conditional-independence-graphs-and-dags"><i class="fa fa-check"></i><b>12.1</b> Conditional independence graphs and DAGs</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="Sparsity.html"><a href="Sparsity.html#conditional-independence"><i class="fa fa-check"></i><b>12.1.1</b> Conditional independence</a></li>
<li class="chapter" data-level="12.1.2" data-path="Sparsity.html"><a href="Sparsity.html#node-removal-properties"><i class="fa fa-check"></i><b>12.1.2</b> Node removal properties</a></li>
<li class="chapter" data-level="12.1.3" data-path="Sparsity.html"><a href="Sparsity.html#directed-acyclic-graph"><i class="fa fa-check"></i><b>12.1.3</b> Directed acyclic graph</a></li>
<li class="chapter" data-level="12.1.4" data-path="Sparsity.html"><a href="Sparsity.html#the-effect-of-adding-data"><i class="fa fa-check"></i><b>12.1.4</b> The effect of adding data</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="Sparsity.html"><a href="Sparsity.html#the-theta-logistic-example"><i class="fa fa-check"></i><b>12.2</b> The theta logistic example</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="Simulation.html"><a href="Simulation.html"><i class="fa fa-check"></i><b>13</b> Simulation</a>
<ul>
<li class="chapter" data-level="13.1" data-path="Simulation.html"><a href="Simulation.html#overview-of-simulation-methods-in-tmb"><i class="fa fa-check"></i><b>13.1</b> Overview of simulation methods in TMB</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="Simulation.html"><a href="Simulation.html#standard-generators"><i class="fa fa-check"></i><b>13.1.1</b> Standard generators</a></li>
<li class="chapter" data-level="13.1.2" data-path="Simulation.html"><a href="Simulation.html#generators-for-density-objects"><i class="fa fa-check"></i><b>13.1.2</b> Generators for density objects</a></li>
<li class="chapter" data-level="13.1.3" data-path="Simulation.html"><a href="Simulation.html#controlling-the-random-seed"><i class="fa fa-check"></i><b>13.1.3</b> Controlling the random seed</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="Simulation.html"><a href="Simulation.html#simulation-blocks"><i class="fa fa-check"></i><b>13.2</b> Simulation blocks</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="Simulation.html"><a href="Simulation.html#a-linear-regression-example"><i class="fa fa-check"></i><b>13.2.1</b> A linear regression example</a></li>
<li class="chapter" data-level="13.2.2" data-path="Simulation.html"><a href="Simulation.html#a-simulation-study"><i class="fa fa-check"></i><b>13.2.2</b> A simulation study</a></li>
<li class="chapter" data-level="13.2.3" data-path="Simulation.html"><a href="Simulation.html#advanced-examples"><i class="fa fa-check"></i><b>13.2.3</b> Advanced examples</a></li>
<li class="chapter" data-level="13.2.4" data-path="Simulation.html"><a href="Simulation.html#further-notes"><i class="fa fa-check"></i><b>13.2.4</b> Further notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="Validation.html"><a href="Validation.html"><i class="fa fa-check"></i><b>14</b> Validation</a>
<ul>
<li class="chapter" data-level="14.1" data-path="Validation.html"><a href="Validation.html#residuals"><i class="fa fa-check"></i><b>14.1</b> Residuals</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="Validation.html"><a href="Validation.html#models-without-random-effects"><i class="fa fa-check"></i><b>14.1.1</b> Models without random effects</a></li>
<li class="chapter" data-level="14.1.2" data-path="Validation.html"><a href="Validation.html#models-with-random-effects"><i class="fa fa-check"></i><b>14.1.2</b> Models with random effects</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="Validation.html"><a href="Validation.html#checking-the-laplace-approximation"><i class="fa fa-check"></i><b>14.2</b> Checking the Laplace approximation</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html"><i class="fa fa-check"></i><b>15</b> Atomic functions</a>
<ul>
<li class="chapter" data-level="15.1" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#reverse-mode-differentiation"><i class="fa fa-check"></i><b>15.1</b> Reverse mode differentiation</a></li>
<li class="chapter" data-level="15.2" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#example-adding-new-primitive-function-with-known-derivatives"><i class="fa fa-check"></i><b>15.2</b> Example: Adding new primitive function with known derivatives</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#testing-the-primitive-function"><i class="fa fa-check"></i><b>15.2.1</b> Testing the primitive function</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="AtomicFunctions.html"><a href="AtomicFunctions.html#other-approaches"><i class="fa fa-check"></i><b>15.3</b> Other approaches</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="Appendix.html"><a href="Appendix.html"><i class="fa fa-check"></i><b>16</b> Appendix</a>
<ul>
<li class="chapter" data-level="16.1" data-path="Appendix.html"><a href="Appendix.html#notation"><i class="fa fa-check"></i><b>16.1</b> Notation</a></li>
<li class="chapter" data-level="16.2" data-path="Appendix.html"><a href="Appendix.html#profiling-the-inner-problem"><i class="fa fa-check"></i><b>16.2</b> Profiling the inner problem</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="Appendix.html"><a href="Appendix.html#example"><i class="fa fa-check"></i><b>16.2.1</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="Appendix.html"><a href="Appendix.html#theory-underlying-sdreport"><i class="fa fa-check"></i><b>16.3</b> Theory underlying sdreport</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The comprehensive TMB documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Tutorial" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Tutorial<a href="Tutorial.html#Tutorial" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>A TMB project consists of an R file (<em>.R) and a C++ file (</em>.cpp). The
R file does pre- and post processing of data in addition to maximizing
the log-likelihood contained in *.cpp. See <a href="Examples.html#Examples">Examples</a> for more
details. All R functions are documented within the standard help
system in R. This tutorial describes how to write the C++ file, and
assumes familiarity with C++ and to some extent with R.</p>
<p>The purpose of the C++ program is to evaluate the objective function,
i.e. the negative log-likelihood of the model. The program is compiled
and called from R, where it can be fed to a function minimizer like
<code>nlminb()</code>.</p>
<p>The objective function should be of the following C++ type:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="Tutorial.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;<a class="code" href="../TMB_8hpp.html">TMB.hpp</a>&gt;</span></span>
<span id="cb1-2"><a href="Tutorial.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="Tutorial.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span>&lt;<span class="kw">class</span> Type&gt;</span>
<span id="cb1-4"><a href="Tutorial.html#cb1-4" aria-hidden="true" tabindex="-1"></a>Type objective_function&lt;Type&gt;::<span class="kw">operator</span>() ()</span>
<span id="cb1-5"><a href="Tutorial.html#cb1-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-6"><a href="Tutorial.html#cb1-6" aria-hidden="true" tabindex="-1"></a>.... Here goes your C++ code ..... </span>
<span id="cb1-7"><a href="Tutorial.html#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The first line includes the source code for the whole TMB package (and
all its dependencies). The objective function is a templated class
where <code>&lt;Type&gt;</code> is the data type of both the input values and
the return value of the objective function. This allows us to
evaluate both the objective function and its derivatives using the
same chunk of C++ code (via the AD package
<a href="http://www.coin-or.org/CppAD/Doc/doxydoc/html/index.html">CppAD</a>). The
technical aspects of this are hidden from the user. There is however
one aspect that surprises the new TMB user. When a constant like “1.2”
is used in a calculation that affects the return value it must be
“cast” to Type:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="Tutorial.html#cb2-1" aria-hidden="true" tabindex="-1"></a>Type nll;           <span class="co">// Define variable that holds the return <a class="code" href="../namespaceTMBad.html#ae0f11020200051df812c0540a9cf7d02">value</a> (neg. log. lik)</span></span>
<span id="cb2-2"><a href="Tutorial.html#cb2-2" aria-hidden="true" tabindex="-1"></a>nll = Type(<span class="fl">1.2</span>);    <span class="co">// Assign <a class="code" href="../namespaceTMBad.html#ae0f11020200051df812c0540a9cf7d02">value</a> 1.2; a cast is needed.</span></span></code></pre></div>
<div id="obtaining-data-and-parameter-values-from-r" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Obtaining data and parameter values from R<a href="Tutorial.html#obtaining-data-and-parameter-values-from-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Obviously, we will need to pass both data and parameter values to the
objective function. This is done through a set of macros that TMB
defines for us.</p>
<div id="list-of-data-macros" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> List of data macros<a href="Tutorial.html#list-of-data-macros" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><code><a class="code" href="../group__macros.html#ga97c14a26ca75571090d332f15130ae4b">DATA_ARRAY</a>()</code>, <code><a class="code" href="../group__macros.html#gace5461529127e9c6f01c0b76b4fda2e6">DATA_FACTOR</a>()</code>, <code><a class="code" href="../group__macros.html#gaf5fe8a4b8a5134f341fa63844abb6fdc">DATA_IARRAY</a>()</code>, <code>DATA_IMATRIX()</code>, <code><a class="code" href="../group__macros.html#gae361b76344dbd1c7cbf5073949211641">DATA_INTEGER</a>()</code>, <code><a class="code" href="../group__macros.html#ga7889208e14a95d21cf630157cf0e2c80">DATA_IVECTOR</a>()</code>, <code><a class="code" href="../group__macros.html#gada5d1729c6988c1060cfa456b56c8d8c">DATA_MATRIX</a>()</code>, <code><a class="code" href="../group__macros.html#ga5a9120a7b504f9502b5d1ce9d0c078ec">DATA_SCALAR</a>()</code>, <code>DATA_SPARSE_MATRIX()</code>, <code><a class="code" href="../group__macros.html#gaba52ba9bd5c88f42a0ce96432aa6e688">DATA_STRING</a>()</code>, <code><a class="code" href="../group__macros.html#gaf9885566da0d248c1a4b4d7a0eeafcd2">DATA_STRUCT</a>()</code>, <code>DATA_UPDATE()</code>, <code><a class="code" href="../group__macros.html#gad334262a7679f343bdc919ae35810161">DATA_VECTOR</a>()</code></p>
</blockquote>
</div>
<div id="list-of-parameter-macros" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> List of parameter macros<a href="Tutorial.html#list-of-parameter-macros" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><code><a class="code" href="../group__macros.html#ga70b2d449f7c53e87abee7d5fb71dc4c0">PARAMETER</a>()</code>, <code><a class="code" href="../group__macros.html#ga6ac3eddb1dd503ceaf4c6ac91546b23e">PARAMETER_ARRAY</a>()</code>, <code>PARAMETER_MATRIX()</code>, <code><a class="code" href="../group__macros.html#ga6b8a70eeee38fe896e89e0a9c6bef84a">PARAMETER_VECTOR</a>()</code></p>
</blockquote>
<p>To see which macros are available start typing
<code>DATA_</code> or <code>PARAMETER_</code> in the Doxygen search field of
your browser (you may need to refresh the browser window between each
time you make a new search). A simple example if you want to read a
vector of numbers (doubles) is the following</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="Tutorial.html#cb3-1" aria-hidden="true" tabindex="-1"></a><a class="code" href="../group__macros.html#gad334262a7679f343bdc919ae35810161">DATA_VECTOR</a>(<a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>);     <span class="co">// Vector <a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>(0),<a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>(1),...,<a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>(n-1), where n is the length of x</span></span></code></pre></div>
<p>Note that all vectors and matrices in TMB uses a <strong>zero-based</strong>
indexing scheme. It is not necessary to explicitly pass the dimension
of <code>x</code>, as it can be retrieved inside the C++ program:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="Tutorial.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n = x.<a class="code" href="../structTMBad_1_1period.html#ad870a607cdf6f2f10c423df5d101a158">size</a>();</span></code></pre></div>
</div>
</div>
<div id="an-extended-c-language" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> An extended C++ language<a href="Tutorial.html#an-extended-c-language" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TMB extends C++ with functionality that is important for formulating
likelihood functions. You have different toolboxes available:</p>
<ul>
<li>Standard C++ used for infrastructure like loops etc.</li>
<li>Vector, matrix and array library (see <a href="matrix_arrays.html#matrix_arrays">Matrices and arrays</a>)</li>
<li>Probability distributions (see <a href="Densities.html#Densities">Densities</a> and <a href="R_style_distribution.html#R_style_distribution">R style distributions</a>)</li>
</ul>
<p>In addition to the variables defined through the <code>DATA_</code> or
<code>PARAMETER_</code> macros there can be “local” variables, for which
ordinary C++ scoping rules apply. There must also be a variable that
holds the return value (neg. log. likelihood).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="Tutorial.html#cb5-1" aria-hidden="true" tabindex="-1"></a><a class="code" href="../group__macros.html#gad334262a7679f343bdc919ae35810161">DATA_VECTOR</a>(<a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>);               <span class="co">// Vector <a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>(0), <a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>(1), ..., <a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>(n-1)</span></span>
<span id="cb5-2"><a href="Tutorial.html#cb5-2" aria-hidden="true" tabindex="-1"></a>Type tmp = <a class="code" href="../structTMBad_1_1ForwardArgs.html#ac77836e3d42c395e3bc4d54037d66056">x</a>(<span class="dv">1</span>);</span>
<span id="cb5-3"><a href="Tutorial.html#cb5-3" aria-hidden="true" tabindex="-1"></a>Type nll = tmp * tmp; </span></code></pre></div>
<p>As in ordinary C++ local variable tmp must be assigned a value before
it can enter into a calculation.</p>
</div>
<div id="statistical-modelling" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Statistical modelling<a href="Tutorial.html#statistical-modelling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>TMB can handle complex statistical problems with hierarchical
structure (latent random variables) and multiple data sources. Latent
random variables must be continuous (discrete distributions are not
handled). The <code>PARAMETER_</code> macros are used to pass two types
of parameters.</p>
<ul>
<li><strong>Parameters</strong>: to be estimated by maximum likelihood. These include
fixed effects and variance components in the mixed model
literature. They will also correspond to hyper parameters with
non-informative priors in the Bayesian literature.</li>
<li><strong>Latent random variables</strong>: to be integrated out of the likelihood
using a Laplace approximation.</li>
</ul>
<p>Which of these are chosen is controlled from R, via the
<code>random</code> argument to the function <code>MakeADFun</code>. However,
on the C++ side it is usually necessary to assign a probability
distribution to the parameter.</p>
<p>The purpose of the C++ program is to calculate the (negative) joint
density of data and latent random variables. Each datum and individual
latent random effect gives a contribution to log likelihood, which may
be though of as a “distribution assignment” by users familiar with
software in the BUGS family.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="Tutorial.html#cb6-1" aria-hidden="true" tabindex="-1"></a><a class="code" href="../group__macros.html#ga6b8a70eeee38fe896e89e0a9c6bef84a">PARAMETER_VECTOR</a>(u);          <span class="co">// Latent random variable </span></span>
<span id="cb6-2"><a href="Tutorial.html#cb6-2" aria-hidden="true" tabindex="-1"></a>Type nll = Type(<span class="dv">0</span>);           <span class="co">// Return value</span></span>
<span id="cb6-3"><a href="Tutorial.html#cb6-3" aria-hidden="true" tabindex="-1"></a>nll -= <a class="code" href="../group__R__style__distribution.html#ga5eb914782c488bd3ec4a50d4e4a73394">dnorm</a>(u(<span class="dv">0</span>),<span class="dv">0</span>,<span class="dv">1</span>,<span class="kw">true</span>)   <span class="co">// Distributional assignment: u(0) ~ N(0,1) </span></span></code></pre></div>
<p>The following rules apply:</p>
<ul>
<li>Distribution assignments do not need to take place before the latent
variable is used in a calculation.</li>
<li>More complicated distributional assignments are allowed, say
<em>u(0)-u(1) ~ N(0,1)</em>, but this requires the user to have a deeper
understanding of the probabilistic aspects of the model.</li>
<li>For latent variables only normal distributions should be used
(otherwise the Laplace approximation will perform poorly). For
response variables all probability distributions (discrete or
continuous) are allowed. If a non-gaussian latent is needed the
“transformation trick” can be used.</li>
<li>The namespaces <a href="R_style_distribution.html#R_style_distribution">R style distributions</a> and <a href="Densities.html#Densities">Densities</a> contain
many probability distributions, including multivariate normal
distributions. For probability distributions not available from
these libraries, the user can use raw C++ code:
<code>{.cpp}     <a class="code" href="../group__macros.html#gad334262a7679f343bdc919ae35810161">DATA_VECTOR</a>(<a class="code" href="../structTMBad_1_1ForwardArgs.html#a962686eac8b51f2b207c5bf666b1e360">y</a>);                   // Data <a class="code" href="../structvector.html">vector</a>     Type nll = Type(0);               // Return <a class="code" href="../namespaceTMBad.html#ae0f11020200051df812c0540a9cf7d02">value</a>     nll -= <a class="code" href="../convenience_8hpp.html#a1fe3cb777e8fd8080385579ab87600e3">sum</a>(-log(Type(1.0)+<a class="code" href="../structTMBad_1_1ForwardArgs.html#a962686eac8b51f2b207c5bf666b1e360">y</a>*<a class="code" href="../structTMBad_1_1ForwardArgs.html#a962686eac8b51f2b207c5bf666b1e360">y</a>));  // <a class="code" href="../structTMBad_1_1ForwardArgs.html#a962686eac8b51f2b207c5bf666b1e360">y</a> are i.i.d. Cauchy distributed</code></li>
</ul>
<p>See <a href="Toolbox.html#Toolbox">Toolbox</a> for more about statistical modelling.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Structure_TMB.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
