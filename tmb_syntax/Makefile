# Allow e.g. "make R=R-devel"
R=R

check_simulations:
	$(R) --slave < check_simulations.R

check_distributions:
	rm -rf autogenerated.*
	$(R) --slave < check_distributions.R

check_autodiff:
	$(R) --slave < check_autodiff.R

matrix_arrays:
	$(R) --slave < matrix_arrays.R

report:
	$(R) --slave < report.R

test_reload:
	$(R) --slave < test_reload.R

test_protect:
	$(R) --slave < test_protect.R

test_UsrapOp:
	$(R) --slave < test_UsrapOp.R

data_update:
	$(R) --slave < data_update.R

clean :
	rm -rf *.o *.so *.dll *~ core *.output.RData *.pdf *.profile
	rm -rf */*.o */*.so */*.dll */*~ core */*.output.RData */*.pdf */*.profile

##########################################################
## For travis tests

## Check that syntax is not broken for projects that depend on TMB
glmmTMB:
	wget http://rawgit.com/glmmTMB/glmmTMB/master/glmmTMB/src/glmmTMB.cpp
	wget http://rawgit.com/glmmTMB/glmmTMB/master/glmmTMB/src/init.h
	echo 'TMB:::compile("glmmTMB.cpp",libinit=FALSE)' | $(R) --slave
spict:
	wget http://rawgit.com/mawp/spict/master/spict/src/spict.cpp
	echo 'TMB:::compile("spict.cpp",CXX="g++")' | $(R) --slave

VAST:
	wget http://rawgit.com/James-Thorson/VAST/master/inst/executables/VAST_v8_0_0.cpp
	echo 'TMB:::compile("VAST_v8_0_0.cpp",CXX="g++")' | $(R) --slave

test:
	make test_UsrapOp
	make check_autodiff
	make data_update
	make test_protect
	make check_simulations
	make report
	make glmmTMB
	make spict
	make VAST
	make matrix_arrays
